[1] docker server 설정 insecure-registry (registy 설치한 서버 대상)
vi /etc/init.d/docker 내 아래 추가
DOCKER_OPTS=--insecure-registry localhost:5000

service docker restart

[2] docker client 설정 insecure-registries (registry에 접속할 모든 대상 서버)
vi /etc/docker/daemon.json
{
  "exec-opts": ["native.cgroupdriver=systemd"],
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "100m"
  },
  "storage-driver": "overlay2",
  "insecure-registries":["172.16.51.166:5000"]
}

service docker restart

[3]
docker pull registry
docker tag f32a97de94e1 172.16.51.166:5000/registry:2.7.1
docker push 172.16.51.166:5000/registry:2.7.1

[4]
docker run -d \
--name=registry \
--restart=always \
-e REGISTRY_HTTP_ADDR=0.0.0.0:5000 \
-e REGISTRY_STORAGE_DELETE_ENABLED=true \
-p 5000:5000 \
-v /data/registry:/var/lib/registry 172.16.51.166:5000/registry:2.7.1



[image delete 방법]
1) curl -X GET 172.16.51.166:5000/v2/_catalog
2) curl -X GET 172.16.51.166:5000/v2/hello-world/tags/list
3) curl -v --silent -H "Accept: application/vnd.docker.distribution.manifest.v2+json" -X GET http://172.16.51.166:5000/v2/hello-world/manifests/latest 2>&1 | grep Docker-Content-Digest | awk '{print ($3)}'
=> sha256:92c7f9c92844bbbb5d0a101b22f7c2a7949e40f8ea90c8b3bc396879d95e899a
4) curl -v --silent -H "Accept: application/vnd.docker.distribution.manifest.v2+json" -X DELETE http://172.16.51.166:5000/v2/hello-world/manifests/sha256:92c7f9c92844bbbb5d0a101b22f7c2a7949e40f8ea90c8b3bc396879d95e899a
