cron 설정

1) crontab 파일 위치 및 조회

작업 설정 파일을 crontab 파일이라고 부르며, 이 파일의 위치는 OS별로 차이가 있다.
리눅스는 /var/spool/cron/ID, 솔라리스는 /var/spool/corn/crontabs/ID 에 위치한다.
그럼 이 파일을 직접 수정해야 하는가? 그렇지 않다. crontab 명령을 통해 설정과 조회를 한다.

설정 내용을 조회해 보자. (-l 옵션)

$ crontab -l
no crontab for truefeel 



2) crontab 파일 형식
------    --------  ---------------------------------------------------
필  드    의  미    범  위
------    --------  ---------------------------------------------------
첫번째    분        0-59
두번째    시        0-23
세번째    일        0-31
네번째    월        1-12
다섯번째  요일      0-7 (0 또는 7=일요일, 1=월, 2=화,...)
여섯번째  명령어    실행할 명령을 한줄로 쓴다.
------    --------  ---------------------------------------------------
- '*'표시는 해당 필드의 모든 시간을 의미한다.
- 3,5,7 와 같이 콤마(,)로 구분하여 여러 시간대를 지정할 수 있다.
- 2-10와 같이 하이픈(-)으로 시간 범위도 지정할 수 있다.
- 2-10/3와 같이 하이픈(-)으로 시간 범위를 슬래쉬(/)로 시간 간격을 지정할 수 있다.
(2~10까지 3간격으로. 즉, 3,6,9를 의미함)

- 한 줄당 하나의 명령 (두줄로 나눠서 표시할 수 없음)
- # 으로 시작하는 줄은 실행하지 않는다.

예제)
# 매일 6시 작업
0 6 * * * ls /applog/infinilink/rte_log/io_cdrm1/io_cdrm1_svr1_rte_$(date -d '-1 week' +%Y%m%d)*.log | xargs gzip > /dev/null 2>&1

# 매일 6시 작업
0 6 * * * ls /applog/infinilink/rte_log/io_cdrm1/io_cdrm1_svr2_rte_$(date -d '-1 week' +%Y%m%d)*.log | xargs gzip > /dev/null 2>&1

# 매일 6시 작업
0 6 * * * ls /applog/infinilink/rte_log/eo_cdrm1/eo_cdrm1_svr1_rte_$(date -d '-1 week' +%Y%m%d)*.log | xargs gzip > /dev/null 2>&1

# 매일 6시 작업
0 6 * * * ls /applog/infinilink/rte_log/eo_cdrm1/eo_cdrm1_svr2_rte_$(date -d '-1 week' +%Y%m%d)*.log | xargs gzip > /dev/null 2>&1


설정을 해보자. (-e 옵션)
crontab -e 을 하면 vi 에디터가 나온다.(환경변수 EDITOR에 따라 다른 에디터를 사용할 수 있다.)

cron이 참조하는 crontab 파일 위치
/var/spool/cron
/etc/cron.d
/etc/crontab

cron은 시작할 때 모든 곳에 저장된 설정파일들을 읽어 메모리에 저장해두고 휴지 상태에 들어간다. 그리고 매분마다 활성화돼 변경된 crontab 파일들이 있는지 확인하고, 변경된 경우 설정을 다시 읽어 저장하고, 그 시간에 실행해야 할 작업이 있는지 확인하고 실행시킨 후 다시 휴지 상태로 들어간다.

/var/spool/cron

시스템 개별 사용자를 위한 crontab 파일 위치이며 일반적으로 root 계정용 하나와 계정 사용자당 1개의 파일을 가진다.

파일명은 사용자의 계정명이며 cron은 이 이름을 바탕으로 각 설정 파일에 지정된 작업들을 실행할 때 사용할 UID를 결정한다. 이 곳에 있는 설정파일들은 crontab 명령으로 관리한다.

/etc/crontab

관리자가 직접 지정한 작업들을 설정하며, 임의의 사용자 권한으로 실행할 수 있다. 시스템 관련 작업들을 등록해 사용하는 곳이다.

/etc/cron.d

소프트웨어 패키지를 설치할 때 필요한 주기적인 작업을 등록하는 공간으로 사용한다. 임의의 사용자 권한으로 실행할 수 있다.

3) cron 삭제
crontab -r

<참고>
/etc/rc.d/init.d/crond start
/etc/rc.d/init.d/crond stop
/etc/rc.d/init.d/crond restart

또는

service crond start
service crond stop
service crond restart